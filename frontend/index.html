<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DSS Mate ‚Äî Trang ch·ªß</title>

  <!-- CSS chung c·ªßa b·∫°n (n·∫øu c√≥) -->
  <link rel="stylesheet" href="./assets/styles.css" />

  <style>
    :root{
      --bg:#0f1115; --card:#161a22; --text:#e7e9ee; --muted:#9aa3b2;
      --border:#222838; --primary:#597bff; --ok:#2ecc71; --no:#ff6b6b;
    }
    *{box-sizing:border-box}
    body{background:var(--bg); color:var(--text); font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif; margin:0}
    a{color:#9db1ff; text-decoration:none}
    .topbar{display:flex; gap:16px; align-items:center; padding:12px 18px; border-bottom:1px solid var(--border); background:#0d1016; position:sticky; top:0; z-index:5}
    .brand{font-weight:800}
    .toplinks{display:flex; gap:16px; align-items:center}
    .spacer{flex:1}
    .btn{border:1px solid var(--border); background:#0f1320; color:var(--text); padding:8px 12px; border-radius:10px; cursor:pointer}
    .btn.primary{background:var(--primary); color:#fff; border-color:transparent}
    .btn.ghost{background:transparent}
    .btn.ok{background:var(--ok); color:#000; border-color:transparent}
    .btn.no{background:var(--no); color:#000; border-color:transparent}
    .container{max-width:1100px; margin:0 auto; padding:18px}
    h1,h2{margin:0 0 12px 0}

    .filters{background:var(--card); border:1px solid var(--border); border-radius:14px; padding:12px; display:grid; grid-template-columns: 1fr 160px 160px 160px 160px 1fr auto; gap:10px}
    .filters input,.filters select{background:#0f1320; color:var(--text); border:1px solid var(--border); border-radius:10px; padding:10px 12px; outline:none}
    @media (max-width:980px){
      .filters{grid-template-columns:1fr 1fr}
    }

    .deck-wrap{margin-top:16px; display:grid; grid-template-columns: 1fr 380px 1fr; gap:16px; align-items:center}
    @media (max-width:980px){
      .deck-wrap{grid-template-columns:1fr}
    }
    .deck{position:relative; width:100%; max-width:380px; height:520px; margin:0 auto}
    .card{position:absolute; inset:0; background:var(--card); border:1px solid var(--border); border-radius:18px; padding:0; box-shadow:0 10px 30px rgba(0,0,0,.25); display:flex; flex-direction:column; overflow:hidden; transition:transform .25s ease, opacity .25s ease}
    .card img.hero{width:100%; height:60%; object-fit:cover; background:#0c0f17}
    .card .meta{padding:12px 14px; display:flex; gap:10px}
    .avatar{width:54px; height:54px; border-radius:50%; object-fit:cover; border:1px solid var(--border)}
    .info{flex:1}
    .name{font-weight:700}
    .row{display:flex; gap:10px; align-items:center}
    .muted{color:var(--muted)}
    .actions{display:flex; gap:12px; justify-content:center; margin-top:12px}
    .end-empty{display:flex; align-items:center; justify-content:center; text-align:center; padding:40px; height:520px; border:1px dashed var(--border); border-radius:18px; color:var(--muted); background:#0d111a}

    .about{margin-top:28px; display:grid; gap:12px}
    .about .card{position:relative; height:auto; padding:16px}
  </style>
</head>
<body>
  <header class="topbar">
    <div class="brand">DSS Mate</div>
    <div class="toplinks">
      <a href="index.html">Trang ch·ªß</a>
      <a href="about.html">About</a>
      <a href="chat.html">Chat</a>
    </div>
    <div class="spacer"></div>
    <a class="btn ghost" href="auth.html">ƒêƒÉng nh·∫≠p</a>
    <a class="btn primary" href="auth.html">ƒêƒÉng k√Ω</a>
  </header>

  <main class="container">
    <section class="filters">
      <input id="fltQuery" placeholder="T√¨m theo t√™n, c√¥ng vi·ªác, s·ªü th√≠ch..."/>
      <label for="fltGender" class="visually-hidden">Ch·ªçn gi·ªõi t√≠nh</label>
      <select id="fltGender">
        <option value="">Gi·ªõi t√≠nh (t·∫•t c·∫£)</option>
        <option value="Nam">Nam</option>
        <option value="N·ªØ">N·ªØ</option>
      </select>
      <input id="fltAgeMin" type="number" min="18" max="70" placeholder="Tu·ªïi t·ª´">
      <input id="fltAgeMax" type="number" min="18" max="70" placeholder="Tu·ªïi ƒë·∫øn">
      <input id="fltDistance" type="number" min="0" placeholder="Kho·∫£ng c√°ch (km)">
      <input id="fltJob" placeholder="C√¥ng vi·ªác">
      <div class="row">
        <button id="btnReset" class="btn">Reset</button>
        <button id="btnFilter" class="btn primary">Filter</button>
      </div>
    </section>

    <section class="deck-wrap">
      <div class="row" style="justify-content:flex-end"></div>

      <div>
        <div id="deck" class="deck"></div>
        <div class="actions">
          <button id="btnSkip" class="btn no">üëé B·ªè qua</button>
          <button id="btnLike" class="btn ok">üëç Th√≠ch</button>
        </div>
        <div class="row" style="justify-content:center; margin-top:6px">
          <span class="muted">M·∫πo: d√πng ph√≠m ‚Üê (b·ªè qua) v√† ‚Üí (th√≠ch)</span>
        </div>
      </div>

      <div class="row" style="justify-content:flex-start"></div>
    </section>

    <section class="about">
      <div class="card"><h3>Minh b·∫°ch</h3><div class="muted">Gi·∫£i th√≠ch ƒëi·ªÉm g·ª£i √Ω theo ti√™u ch√≠ r√µ r√†ng.</div></div>
      <div class="card"><h3>B·∫£o m·∫≠t</h3><div class="muted">T·ªëi thi·ªÉu h√≥a th√¥ng tin nh·∫°y c·∫£m, l∆∞u tr·ªØ an to√†n.</div></div>
      <div class="card"><h3>Nhanh g·ªçn</h3><div class="muted">T·ªëi ∆∞u thao t√°c, qu·∫πt tr√°i/ph·∫£i tr·ª±c quan.</div></div>
    </section>
  </main>

  <script src="./js/app.js"></script>
  <script>
    // ===== 10 ng∆∞·ªùi m·∫´u (fallback) =====
    const MOCK = [
      { id:"u001", fullName:"Tran A",   age:26, gender:"N·ªØ",  occupation:"Designer", finance:20, distanceKm:2.1, avatarUrl:"https://i.pravatar.cc/240?img=1", cover:"https://images.unsplash.com/photo-1520975922284-6d98aadc3f9b?q=80&w=1200&auto=format&fit=crop" },
      { id:"u002", fullName:"Le B",     age:29, gender:"Nam",  occupation:"Dev",      finance:35, distanceKm:4.5, avatarUrl:"https://i.pravatar.cc/240?img=5", cover:"https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=1200&auto=format&fit=crop" },
      { id:"u003", fullName:"Nguyen C", age:24, gender:"N·ªØ",  occupation:"Content",  finance:18, distanceKm:1.0, avatarUrl:"https://i.pravatar.cc/240?img=11",cover:"https://images.unsplash.com/photo-1520975922284-6d98aadc3f9b?q=80&w=1200&auto=format&fit=crop" },
      { id:"u004", fullName:"Pham D",   age:32, gender:"Nam",  occupation:"QA",       finance:28, distanceKm:7.8, avatarUrl:"https://i.pravatar.cc/240?img=8", cover:"https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=1200&auto=format&fit=crop" },
      { id:"u005", fullName:"Do E",     age:27, gender:"N·ªØ",  occupation:"Nurse",    finance:22, distanceKm:3.4, avatarUrl:"https://i.pravatar.cc/240?img=15",cover:"https://images.unsplash.com/photo-1520975922284-6d98aadc3f9b?q=80&w=1200&auto=format&fit=crop" },
      { id:"u006", fullName:"Bui F",    age:30, gender:"Nam",  occupation:"PM",       finance:45, distanceKm:5.2, avatarUrl:"https://i.pravatar.cc/240?img=20",cover:"https://images.unsplash.com/photo-1520975922284-6d98aadc3f9b?q=80&w=1200&auto=format&fit=crop" },
      { id:"u007", fullName:"Ly G",     age:25, gender:"N·ªØ",  occupation:"CSKH",     finance:17, distanceKm:2.8, avatarUrl:"https://i.pravatar.cc/240?img=31",cover:"https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=1200&auto=format&fit=crop" },
      { id:"u008", fullName:"Hoang H",  age:28, gender:"Nam",  occupation:"Data Eng", finance:50, distanceKm:6.6, avatarUrl:"https://i.pravatar.cc/240?img=28",cover:"https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=1200&auto=format&fit=crop" },
      { id:"u009", fullName:"Vu I",     age:23, gender:"N·ªØ",  occupation:"Sinh vi√™n", finance:8,  distanceKm:1.7, avatarUrl:"https://i.pravatar.cc/240?img=47",cover:"https://images.unsplash.com/photo-1520975922284-6d98aadc3f9b?q=80&w=1200&auto=format&fit=crop" },
      { id:"u010", fullName:"Phan K",   age:34, gender:"Nam",  occupation:"K·∫ø to√°n",  finance:27, distanceKm:9.2, avatarUrl:"https://i.pravatar.cc/240?img=67",cover:"https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=1200&auto=format&fit=crop" },
    ];

    const qs = (s, el=document) => el.querySelector(s);
    const deckEl = qs('#deck');

    let dataset = [];
    let pointer = 0;

    function cardHtml(c){
      return `
        <div class="card" data-id="${c.id}">
          <img class="hero" src="${c.cover || '/uploads/default_1.jpg'}" alt="">
          <div class="meta">
            <img class="avatar" src="${c.avatarUrl || '/uploads/default_1.jpg'}" onerror="this.src='/uploads/default_1.jpg'">
            <div class="info">
              <div class="name">${c.fullName} ${c.age?`‚Ä¢ ${c.age}`:''}</div>
              <div class="muted">${c.occupation || '‚Äî'}</div>
              <div class="muted">T√†i ch√≠nh: ${c.finance? c.finance+' tr/th√°ng':'‚Äî'} ‚Ä¢ C√°ch ${c.distanceKm??'‚Äî'}km</div>
            </div>
          </div>
        </div>
      `;
    }
    function renderDeck(list){
      deckEl.innerHTML = '';
      if(!list || list.length===0){
        deckEl.innerHTML = `<div class="end-empty">Kh√¥ng c√≥ ·ª©ng vi√™n. H√£y thay ƒë·ªïi b·ªô l·ªçc.</div>`;
        return;
      }
      const copy = [...list].slice(pointer).reverse();
      copy.forEach(c => deckEl.insertAdjacentHTML('beforeend', cardHtml(c)));
    }
    function current(){ return pointer < dataset.length ? dataset[pointer] : null; }

    async function like(dir){
      const c = current(); if(!c) return;
      const topCard = deckEl.querySelector('.card:last-child');
      if(topCard){
        topCard.style.transform = `translateX(${dir>0?120:-120}px) rotate(${dir>0?8:-8}deg)`;
        topCard.style.opacity = '0';
        setTimeout(() => topCard.remove(), 220);
      }

      if (dir > 0) {
        let matched = false, matchId = null;
        try{
          const me = JSON.parse(localStorage.getItem('dss.user') || 'null');
          const meId = me?.userId || 'me';
          if (window.api?.swipe){
            const res = await window.api.swipe(meId, c.id, 1); // { matched, matchId } n·∫øu backend h·ªó tr·ª£
            matched = !!res?.matched; matchId = res?.matchId || null;
          } else {
            // demo: coi nh∆∞ match lu√¥n
            matched = true; matchId = 'mock-' + c.id;
          }
        }catch(e){ console.warn(e); }

        if (matched && matchId){
          localStorage.setItem('chat.openMatchId', matchId);
          localStorage.removeItem('chat.openWith');
        } else {
          localStorage.setItem('chat.openWith', c.id);
          localStorage.removeItem('chat.openMatchId');
        }
        location.href = 'chat.html';
        return;
      }

      // b·ªè qua
      pointer++;
      if(pointer >= dataset.length){
        setTimeout(()=> { deckEl.innerHTML = `<div class="end-empty">H·∫øt g·ª£i √Ω ‚Ä¢ H√£y th·ª≠ l·ªçc l·∫°i nh√©</div>`; }, 230);
      }
    }

    window.addEventListener('keydown', (e) => {
      if(e.key === 'ArrowLeft') like(-1);
      if(e.key === 'ArrowRight') like(1);
    });
    qs('#btnLike').onclick = () => like(1);
    qs('#btnSkip').onclick = () => like(-1);

    qs('#btnReset').onclick = () => {
      ['fltQuery','fltGender','fltAgeMin','fltAgeMax','fltDistance','fltJob'].forEach(id=>{
        const el = qs('#'+id); if(el) el.value = '';
      });
      loadData({});
    };
    qs('#btnFilter').onclick = () => {
      const filters = {
        q:       qs('#fltQuery').value.trim(),
        gender:  qs('#fltGender').value,
        ageMin:  parseInt(qs('#fltAgeMin').value) || null,
        ageMax:  parseInt(qs('#fltAgeMax').value) || null,
        distanceKm: parseInt(qs('#fltDistance').value) || null,
        job:     qs('#fltJob').value.trim()
      };
      loadData(filters);
    };

    async function loadData(filters={}){
      pointer = 0;
      if(window.api?.searchCandidates){
        try{
          dataset = await window.api.searchCandidates(filters);
        }catch(e){
          console.warn('search API fail, use mock', e);
          dataset = filterMock(MOCK, filters);
        }
      }else{
        dataset = filterMock(MOCK, filters);
      }
      renderDeck(dataset);
    }
    function filterMock(arr, f){
      let out = [...arr];
      if(f.q){
        const q = f.q.toLowerCase();
        out = out.filter(x => (x.fullName+' '+(x.occupation||'')).toLowerCase().includes(q));
      }
      if(f.gender){
        const g = f.gender.toLowerCase();
        out = out.filter(x => (x.gender||'').toLowerCase().startsWith(g[0]));
      }
      if(f.ageMin) out = out.filter(x => x.age>=f.ageMin);
      if(f.ageMax) out = out.filter(x => x.age<=f.ageMax);
      if(f.job){
        const j = f.job.toLowerCase();
        out = out.filter(x => (x.occupation||'').toLowerCase().includes(j));
      }
      if(f.distanceKm!=null) out = out.filter(x => (x.distanceKm||999) <= f.distanceKm);
      return out;
    }

    loadData({});
  </script>
</body>
</html>
